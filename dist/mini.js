import{h}from"hyperapp";var error=e=>({errors:t})=>{let r=Object.entries(t).reduce((e,[t,r])=>e||r,"");return h("p",{...e,class:"error",hidden:!r},r)},widget=(e,t,r)=>({values:a,errors:o,submitted:s,register:i,SetValues:l,SetErrors:n})=>{t&&i(r=>({...r,[e]:t(a[e],a)}));const d=t?(r,s)=>[n,{...o,[e]:t(s,a)}]:e=>e;return r({disabled:s,value:a[e],error:o[e],Set:(t,r)=>[l,{...a,[e]:r}],Validate:d})};const effect=(e=>t=>(...r)=>[e,{f:t,a:r}])((e,{f:t,a:r})=>t(e,...r)),preventDefault=effect((e,t)=>t.preventDefault()),dispatch=effect((e,t,r)=>e(t,r));var batch=(...e)=>(t,r)=>[t,...e.map(e=>dispatch(e,r))],check=e=>widget(e.name,e.validator,({value:t,error:r,disabled:a,Set:o,Validate:s},i=e.value||"on")=>h("input",{...e,type:"checkbox",class:[e.class,{error:r}],disabled:a,checked:Array.isArray(t)?t.indexOf(i)>=0:t===i,name:e.name,value:i,onchange:(e,r,a=[...(t?Array.isArray(t)?t:[t]:[]).filter(e=>e!==i),...r.target.checked?[i]:[]])=>[batch(o,s),a.length>1?a:1==a.length?a[0]:""]})),radio=e=>widget(e.name,e.validator,({value:t,error:r,disabled:a,Set:o,Validate:s})=>h("input",{...e,type:"radio",class:[e.class,{error:r}],value:e.value||"on",disabled:a,checked:t===(e.value||"on"),onchange:[batch(o,s),e.value||"on"]})),input=e=>"checkbox"===e.type?check(e):"radio"===e.type?radio(e):widget(e.name,e.validator,({value:t,error:r,disabled:a,Set:o,Validate:s})=>h("input",{...e,disabled:a,type:e.type||"text",class:[e.class,{error:!!r}],value:t,oninput:(e,t)=>[batch(o,s),t.target.value],...void 0===t?{}:{onblur:[s,t]}})),button=(e,t)=>({submitted:r})=>h("button",{...e,type:e.type||"button",disabled:r},t),init=(e={},t={})=>({values:e,errors:t,submitted:!1});const Submit=(e,{event:t,onsubmit:r,validators:a,getFormState:o,setFormState:s})=>{let i=o(e);if(i.submitted)return e;let l=a.reduce((e,t)=>t(e),{}),n=Object.entries(l).reduce((e,[t,r])=>e&&!r,!0);return[s(e,{...i,errors:l,submitted:n}),n&&dispatch(r,i.values),preventDefault(t)]},_Set=(e,t,r,a=t.getFormState(e))=>a.submitted?e:[t.setFormState,{...a,[r]:t[r]}],SetValues=(e,t)=>_Set(e,t,"values"),SetErrors=(e,t)=>_Set(e,t,"errors"),provide=(e,t)=>Array.isArray(t)?t.map(t=>provide(e,t)).flat():"function"==typeof t?provide(e,t(e)):"function"==typeof t.name?provide(e,t.name(e)):{...t,children:provide(e,t.children)},_formActions=(e,t)=>(r,a)=>(o,s)=>[r,{...a(s),getFormState:e,setFormState:t}],formActions=(e,t,r,a)=>{const o=(s=e,i=t,(e,t)=>(r,a)=>[e,{...t(a),getFormState:s,setFormState:i}]);var s,i;return{Submit:o(Submit,e=>({event:e,onsubmit:r,validators:a})),SetValues:o(SetValues,e=>({values:e})),SetErrors:o(SetErrors,e=>({errors:e}))}};var form=({state:e,getFormState:t,setFormState:r,onsubmit:a},o)=>{const s=[],{Submit:i,SetValues:l,SetErrors:n}=formActions(t,r,a,s);return h("form",{onsubmit:i},provide({...e,register:e=>s.push(e),SetValues:l,SetErrors:n},o))},select=(e,t)=>widget(e.name,e.validator,({value:r,error:a,disabled:o,Set:s,Validate:i})=>h("select",{...e,class:[e.class,{error:a}],name:e.name,value:r,disabled:o,oninput:(e,t)=>[batch(s,i),t.target.value]},t.map(e=>"option"!==e.name||!r||e.props.value!==r&&e.children[0].name!==r?e:{...e,props:{...e.props,selected:!0}})));export{batch,button,error,form,init,input,provide,select,widget};
