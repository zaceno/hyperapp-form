var hyperappform=function(e,t){"use strict";var r=(e,t,r)=>({values:a,errors:s,submitted:o,register:l,SetValues:n,SetErrors:i})=>{t&&l(r=>({...r,[e]:t(a[e],a)}));const u=t?(r,o)=>[i,{...s,[e]:t(o,a)}]:e=>e;return r({disabled:o,value:a[e],error:s[e],Set:(t,r)=>[n,{...a,[e]:r}],Validate:u})};const a=(s=(e,{f:t,a:r})=>t(e,...r),e=>(...t)=>[s,{f:e,a:t}]);var s;const o=a((e,t)=>t.preventDefault()),l=a((e,t,r)=>e(t,r));var n=(...e)=>(t,r)=>[t,...e.map(e=>l(e,r))];const i=(e,{event:t,onsubmit:r,validators:a,getFormState:s,setFormState:n})=>{let i=s(e);if(i.submitted)return e;let u=a.reduce((e,t)=>t(e),{}),d=Object.entries(u).reduce((e,[t,r])=>e&&!r,!0);return[n(e,{...i,errors:u,submitted:d}),d&&l(r,i.values),o(t)]},u=(e,t,r,a=t.getFormState(e))=>a.submitted?e:[t.setFormState,{...a,[r]:t[r]}],d=(e,t)=>u(e,t,"values"),c=(e,t)=>u(e,t,"errors"),m=(e,t)=>Array.isArray(t)?t.map(t=>m(e,t)).flat():"function"==typeof t?m(e,t(e)):"function"==typeof t.name?m(e,t.name(e)):{...t,children:m(e,t.children)},v=(e,t,r,a)=>{const s=(o=e,l=t,(e,t)=>(r,a)=>[e,{...t(a),getFormState:o,setFormState:l}]);var o,l;return{Submit:s(i,e=>({event:e,onsubmit:r,validators:a})),SetValues:s(d,e=>({values:e})),SetErrors:s(c,e=>({errors:e}))}};return e.batch=n,e.button=(e,r)=>({submitted:a})=>t.h("button",{...e,type:e.type||"button",disabled:a},r),e.error=e=>({errors:r})=>{let a=Object.entries(r).reduce((e,[t,r])=>e||r,"");return t.h("p",{...e,class:"error",hidden:!a},a)},e.form=({state:e,getFormState:r,setFormState:a,onsubmit:s},o)=>{const l=[],{Submit:n,SetValues:i,SetErrors:u}=v(r,a,s,l);return t.h("form",{onsubmit:n},m({...e,register:e=>l.push(e),SetValues:i,SetErrors:u},o))},e.init=(e={},t={})=>({values:e,errors:t,submitted:!1}),e.input=e=>"checkbox"===e.type?(e=>r(e.name,e.validator,({value:r,error:a,disabled:s,Set:o,Validate:l},i=e.value||"on")=>t.h("input",{...e,type:"checkbox",class:[e.class,{error:a}],disabled:s,checked:Array.isArray(r)?r.indexOf(i)>=0:r===i,name:e.name,value:i,onchange:(e,t,a=[...(r?Array.isArray(r)?r:[r]:[]).filter(e=>e!==i),...t.target.checked?[i]:[]])=>[n(o,l),a.length>1?a:1==a.length?a[0]:""]})))(e):"radio"===e.type?(e=>r(e.name,e.validator,({value:r,error:a,disabled:s,Set:o,Validate:l})=>t.h("input",{...e,type:"radio",class:[e.class,{error:a}],value:e.value||"on",disabled:s,checked:r===(e.value||"on"),onchange:[n(o,l),e.value||"on"]})))(e):r(e.name,e.validator,({value:r,error:a,disabled:s,Set:o,Validate:l})=>t.h("input",{...e,disabled:s,type:e.type||"text",class:[e.class,{error:!!a}],value:r,oninput:(e,t)=>[n(o,l),t.target.value],...void 0===r?{}:{onblur:[l,r]}})),e.provide=m,e.select=(e,a)=>r(e.name,e.validator,({value:r,error:s,disabled:o,Set:l,Validate:i})=>t.h("select",{...e,class:[e.class,{error:s}],name:e.name,value:r,disabled:o,oninput:(e,t)=>[n(l,i),t.target.value]},a.map(e=>"option"!==e.name||!r||e.props.value!==r&&e.children[0].name!==r?e:{...e,props:{...e.props,selected:!0}}))),e.widget=r,e}({},hyperapp);
