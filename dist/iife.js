var hyperappform=function(e,t){"use strict";var r=(e,t,r)=>({values:a,errors:s,submitted:o,register:l,SetValues:n,SetErrors:i})=>{t&&l((r,a)=>({...r,[e]:t(a[e],a)}));const u=[n,t=>({...a,[e]:t})],d=t?[i,r=>({...s,[e]:t(r,a)})]:e=>e;return r({disabled:o,value:a[e],error:s[e],Set:u,Validate:d})};const a=(s=(e,{f:t,a:r})=>t(e,...r),e=>(...t)=>[s,{f:e,a:t}]);var s;const o=a((e,t)=>t.preventDefault()),l=a((e,t,r)=>e(t,r));var n=(...e)=>(t,r)=>[t,...e.map(e=>l(e,r))];const i=(e,{event:t,onsubmit:r,validators:a,getFormState:s,setFormState:n})=>{let i=s(e);if(i.submitted)return e;let u=a.reduce((e,t)=>t(e,i.values),{}),d=Object.entries(u).reduce((e,[t,r])=>e&&!r,!0);return[n(e,{...i,errors:u,submitted:d}),d&&l(r,i.values),o(t)]},u=(e,t,r,a=t.getFormState(e))=>a.submitted?e:[t.setFormState,{...a,[r]:t[r]}],d=(e,t)=>u(e,t,"values"),c=(e,t)=>u(e,t,"errors"),v=(e,t)=>Array.isArray(t)?t.map(t=>v(e,t)).flat():"function"==typeof t?v(e,t(e)):"function"==typeof t.name?v(e,t.name(e)):{...t,children:v(e,t.children)};return e.batch=n,e.button=(e,r)=>({submitted:a})=>t.h("button",{...e,type:e.type||"button",disabled:a},r),e.error=e=>({errors:r})=>{let a=Object.entries(r).reduce((e,[t,r])=>e||r,"");return t.h("p",{...e,class:"error",hidden:!a},a)},e.form=({state:e,getFormState:r,setFormState:a,onsubmit:s},o)=>{const l=[],n=e=>({...e,setFormState:a,getFormState:r});return t.h("form",{onsubmit:[i,e=>n({event:e,onsubmit:s,validators:l})]},v({...e,register:e=>l.push(e),SetValues:[d,e=>n({values:e})],SetErrors:[c,e=>n({errors:e})]},o))},e.init=(e={},t={})=>({values:e,errors:t,submitted:!1}),e.input=e=>"checkbox"===e.type?(e=>r(e.name,e.validator,({value:r,error:a,disabled:s,Set:o,Validate:l},i=e.value||"on")=>t.h("input",{...e,type:"checkbox",class:[e.class,{error:a}],disabled:s,checked:Array.isArray(r)?r.indexOf(i)>=0:r===i,name:e.name,value:i,onchange:[n(o,l),(e,t=[...(r?Array.isArray(r)?r:[r]:[]).filter(e=>e!==i),...e.target.checked?[i]:[]])=>t.length>1?t:1==t.length?t[0]:""]})))(e):"radio"===e.type?(e=>r(e.name,e.validator,({value:r,error:a,disabled:s,Set:o,Validate:l})=>t.h("input",{...e,type:"radio",class:[e.class,{error:a}],value:e.value||"on",disabled:s,checked:r===(e.value||"on"),onchange:[n(o,l),e.value||"on"]})))(e):r(e.name,e.validator,({value:r,error:a,disabled:s,Set:o,Validate:l})=>t.h("input",{...e,disabled:s,type:e.type||"text",class:[e.class,{error:!!a}],value:r,oninput:[a?n(o,l):o,e=>e.target.value],...void 0===r?{}:{onblur:[l,r]}})),e.provide=v,e.select=(e,a)=>r(e.name,e.validator,({value:r,error:s,disabled:o,Set:l,Validate:i})=>t.h("select",{...e,class:[e.class,{error:s}],name:e.name,value:r,disabled:o,oninput:[n(l,i),e=>e.target.value]},a.map(e=>"option"!==e.name||!r||e.props.value!==r&&e.children[0].name!==r?e:{...e,props:{...e.props,selected:!0}}))),e.widget=r,e}({},hyperapp);
